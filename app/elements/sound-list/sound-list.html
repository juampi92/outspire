<!--
@license
Copyright (c) 2015 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<dom-module id='sound-list'>
  <style>
    :host {
      display: block;
    }
    paper-item {
      border-bottom: 1px solid #CCC;
    }
    paper-icon-button {
      margin-right: 30px;
    }
    b {
      font-size: 20px;
    }
    paper-progress {
      width: 100%;
      top: -15px;
      position: relative;
      height: 4px;
    }
  </style>
  <template>
    <div class="list">
      <template is="dom-repeat" items="{{items}}">
        <paper-item>
          <paper-spinner active="{{item.loading}}"></paper-spinner>
          <paper-icon-button role="listitem" icon="clear" on-click="remove" item-icon></paper-icon-button>
          <paper-item-body two-line>
            <div>
              <b>{{item.name}}</b>
            </div>
            <div>
              <sound-player src="{{item.src}}" progress="{{item.progress}}" loaded="{{item.loaded}}" loading="{{item.loading}}" volume="{{item.volume}}" muted="{{item.muted}}"></sound-player>
            </div>
          </paper-item-body>
        </paper-item>
        <paper-progress value="{{item.progress}}" hidden$="{{item.loaded}}"></paper-progress>
      </template>
    </div>
  </template>

</dom-module>
  <script>
    (function() {
      var app = document.getElementById('app');

      Polymer({
        is: 'sound-list',
        properties: {
          items: {
            type: Array,
            notify: true,
          }
        },
        fromJSON: function(json){
          for (var i = 0, cursor; i < json.length; i++) {
            cursor = json[i];
            this.add(cursor.id, cursor);
          }
        },
        toJSON: function(){
          return this.items.filter(function(el) {
            return {
              id: el.id,
              volume: el.volume,
              muted: el.muted
            };
          });
        },
        ready: function(){
          this.items = [];
        },
        remove: function(e) {
          var id = e.model.__data__.item.id;
          this.items = this.items.filter(function(el) {
            return el.id !== id;
          });
        },
        add: function(id, options) {
          var base = app.data.sounds[id],
            sound = {
              id: id,
              src: base.src,
              volume: options.volume || 10,
              muted: options.muted || false,
              loading: true,
              loaded: false
            };

          this.items = this.items.concat(sound);
        }
      });
    })();
  </script>
